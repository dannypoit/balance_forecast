<body>
  <header>
    <h1>Balance Forecast</h1>
    <% if current_user %>
      <div class="dropdown d-inline">
        <a class="dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Settings
        </a>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <%= link_to 'Change email or password', edit_user_registration_path(current_user), class: 'dropdown-item' %>
        </div>
      </div>
      <%= link_to "Log out", destroy_user_session_path, method: :delete %>
    <% else %>
      <%= link_to "Log In", new_user_session_path %>
    <% end %>
  </header>

  <main role="main">
    <% if notice.present? %>
      <p class="notice"><%= notice %></p>
    <% end %>

    <% if alert.present? %>
      <p class="alert"><%= alert %></p>
    <% end %>

    <% if current_user %> <!-- can take this conditional out later when index only shows when user is logged in -->
      <p>Current balance: $<%= (current_user.current_balance / 100.00).round %></p>
    <% end %>

    <div class="container">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">
              Date
            </th>
            <th scope="col">
              Description
            </th>
            <th scope="col">
              Frequency
            </th>
            <th scope="col">
              Amount
            </th>
            <th scope="col">
              Balance
            </th>
          </tr>
        </thead>
        <tbody>
          <% new_balance = nil %> <!-- not sure if needed yet -->
          <% @entries.each do |entry| %>
            <tr>
              <td>
                <%= entry.date %>
              </td>
              <td>
                <%= entry.description %>
              </td>
              <td>
                <%= entry.frequency %>
              </td>
              <td>
                $<%= (entry.amount / 100.00).round %>
              </td>
              <td>
                <% if current_user %> <!-- can take this conditional out later when index only shows when user is logged in -->
                  <% if new_balance.nil? %>
                    <% new_balance = (current_user.current_balance / 100.00).round %>
                  <% end %>
                  <% new_balance = new_balance - (entry.amount / 100.00).round %>
                  $<%= new_balance %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </main>
