<body>
  <header>
    <h1>Balance Forecast</h1>
    <% if current_user %>
      <div class="dropdown d-inline">
        <a class="dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Settings
        </a>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <%= link_to 'Change email or password', edit_user_registration_path(current_user), class: 'dropdown-item' %>
        </div>
      </div>
      <%= link_to "Log out", destroy_user_session_path, method: :delete %>
    <% else %>
      <%= link_to "Log In", new_user_session_path %>
    <% end %>
  </header>

  <main role="main">
    
    <div class="container">
      <% if notice.present? %>
        <div class="alert alert-info" role="alert"><%= notice %></div>
      <% end %>

      <% if alert.present? %>
        <div class="alert alert-danger" role="alert"><%= alert %></div>
      <% end %>

      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th></th><th></th><th></th>
            <th>
              Current balance:
            </th>
            <th>
              $<span id="currentBalance"><%= (current_user.current_balance / 100.00).round %></span>
            </th>
          </tr>
          <tr>
            <th scope="col">
              Date
            </th>
            <th scope="col">
              Description
            </th>
            <th scope="col">
              Frequency
            </th>
            <th scope="col">
              Amount
            </th>
            <th scope="col">
              Balance
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
          <%= form_for(@entry) do |f| %>
            <td>
              <%= f.date_field :date %>
            </td>
            <td>
              <%= f.text_field :description %>
            </td>
            <td>
              <%= f.text_field :frequency %> <!-- change to dropdown -->
            </td>
            <td>
              <%= f.number_field :amount %>
              <p class="text-muted small m-0">(in cents)</p>
            </td>
            <td>
              <%= f.submit 'Add' %>
            </td>
          <% end %>
          </tr>
          <% new_balance = (current_user.current_balance / 100.00).round %>
          <% current_user.entries.each do |entry| %>
            <tr>
              <td>
                <%= entry.date %>
              </td>
              <td>
                <%= entry.description %>
              </td>
              <td>
                <%= entry.frequency %>
              </td>
              <td>
                $<%= (entry.amount / 100.00).round %>
              </td>
              <td>
                <% new_balance = new_balance - (entry.amount / 100.00).round %>
                $<%= new_balance %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </main>

  <footer>

  </footer>

  <script>
    $(function() {
      $.get("/entries").success(function(data) {
        var currentBalance = document.getElementById("currentBalance").innerHTML;
        var newBalance = parseInt(currentBalance);
        $.each(data, function(index, entry) {
          newBalance = newBalance - Math.round(entry.amount / 100.00)
          var trElement = '<tr><td>' + entry.date + '</td><td>' + entry.description + '</td><td>' + entry.frequency + '</td><td>$' + Math.round(entry.amount / 100.00) + '</td><td>$' + 
          newBalance
          + '</td></tr>';
          console.log(trElement);
        });
      });
    });
  </script>